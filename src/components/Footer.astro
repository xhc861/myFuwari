---
import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
const launchDate = new Date("2026-01-02");
const today = new Date();
const daysRunning = Math.floor(
	(today.getTime() - launchDate.getTime()) / (1000 * 60 * 60 * 24),
);

let dailyQuote = "愿你眼中总有光芒，活成你想要的模样。";

// 尝试从每日一言API获取句子
try {
	const res = await fetch("https://v1.hitokoto.cn?c=i&encode=json");
	if (res.ok) {
		const data = await res.json();
		if (data?.hitokoto) {
			dailyQuote = `"${data.hitokoto}" — ${data.from || "佚名"}`;
		}
	}
} catch (e) {
	console.warn("每日一言 API 获取失败，使用默认句。");
}
---

<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>

<div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6 space-y-4 text-center">
    <!-- 每日一言 -->
    <div id="daily-quote" class="text-sm italic text-gray-600 dark:text-gray-400">
        {dailyQuote}
    </div>

    <!-- 安全运行天数 -->
    <div class="text-xs text-gray-500 dark:text-gray-400">
        本网站已安全运行 <span id="run-days">{daysRunning}</span> 天
    </div>

    <!-- 底部信息 -->
    <div class="transition text-50 text-sm text-center">
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name}. All Rights Reserved. /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('rss.xml')}>RSS</a> /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('sitemap-index.xml')}>Sitemap</a><br>
        本网站使用
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> 和
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a>
        项目并二次开发
    </div>
</div>

<script>
  // 客户端脚本 - 动态更新运行时间和诗句
  // 这个脚本在客户端执行，确保每次访问都能获取最新数据
  
  function updateFooter() {
    // 更新运行时间
    const launchDate = new Date("2026-01-02");
    const today = new Date();
    const daysRunning = Math.floor((today.getTime() - launchDate.getTime()) / (1000 * 60 * 60 * 24));
    const runDaysElement = document.getElementById('run-days');
    if (runDaysElement) {
      runDaysElement.textContent = String(daysRunning);
    }

    // 获取每日一言
    fetch("https://v1.hitokoto.cn?c=i&encode=json")
      .then(res => {
        if (!res.ok) throw new Error('API request failed');
        return res.json();
      })
      .then(data => {
        if (data && data.hitokoto) {
          const dailyQuoteElement = document.getElementById('daily-quote');
          if (dailyQuoteElement) {
            dailyQuoteElement.textContent = `"${data.hitokoto}" — ${data.from || "佚名"}`;
          }
        }
      })
      .catch(e => {
        console.warn("每日一言 API 获取失败:", e.message);
        // 保持使用服务端渲染的默认值
      });
  }

  // 页面加载完成后执行
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateFooter);
  } else {
    updateFooter();
  }

  // 可选：定期刷新运行时间（每分钟更新一次）
  setInterval(() => {
    const launchDate = new Date("2026-01-02");
    const today = new Date();
    const daysRunning = Math.floor((today.getTime() - launchDate.getTime()) / (1000 * 60 * 60 * 24));
    const runDaysElement = document.getElementById('run-days');
    if (runDaysElement) {
      runDaysElement.textContent = String(daysRunning);
    }
  }, 60000); // 每60秒更新一次
</script>
